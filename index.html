<!DOCTYPE html>
<html>
<head>
  <title>Astro Sifir</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>

  <style>
    body {
      margin: 0;
      font-family: Arial;
      background: radial-gradient(circle at top, #1b2735, #090a0f);
      color: white;
      text-align: center;
      overflow: hidden;
    }

    h1 { margin-top: 10px; }

    .game-area {
      position: relative;
      height: 400px;
      width: 80%;
      margin: 20px auto;
      border: 2px solid #00c6ff;
      border-radius: 10px;
      overflow: hidden;
    }

    #hero {
      position: absolute;
      bottom: 10px;
      left: 45%;
      font-size: 40px;
      transition: left 0.1s;
    }

    .asteroid {
      position: absolute;
      top: -60px;
      font-size: 30px;
      text-align: center;
      width: 60px;
    }

    .number {
      font-size: 18px;
    }

    .stats {
      margin-top: 10px;
    }
  </style>
</head>

<body>

<h1>üöÄ Astro Sifir</h1>

<div>
  Nama: <input type="text" id="name">
  Kelas: <input type="text" id="class">
</div>

<div class="game-area" id="gameArea">
  <div id="hero">üöÄ</div>
</div>
<div id="question" style="font-size:24px;margin-top:10px;"></div>
<div class="stats">
  Skor: <span id="score">0</span> |
  Nyawa: <span id="lives">3</span>
</div>

<script>
  const supabaseUrl = "https://vocabjqcevsauktpujap.supabase.co";
  const supabaseKey = "PASTE_ANON_KEY_HERE";
  const { createClient } = supabase;
  const supabaseClient = createClient(supabaseUrl, supabaseKey);

  let hero = document.getElementById("hero");
  let gameArea = document.getElementById("gameArea");

  let heroPos = 45;
  let score = 0;
  let lives = 3;
  let sifir = 6;
  let gameOver = false;

  // üéÆ MOVE HERO
  document.addEventListener("keydown", (e) => {
    if (e.key === "ArrowLeft") {
      heroPos -= 5;
      if (heroPos < 0) heroPos = 0;
    }
    if (e.key === "ArrowRight") {
      heroPos += 5;
      if (heroPos > 90) heroPos = 90;
    }
    hero.style.left = heroPos + "%";
  });

function spawnAsteroids() {
  if (gameOver) return;

  let a = sifir;
  let b = Math.floor(Math.random() * 10) + 1;
  let correctAnswer = a * b;

  // üëâ PAPAR SOALAN
  document.getElementById("question").innerText = `${a} x ${b} = ?`;

  let answers = [correctAnswer];

  while (answers.length < 4) {
    let fake = Math.floor(Math.random() * 100);
    if (!answers.includes(fake)) answers.push(fake);
  }

  gameArea.innerHTML = '<div id="hero">üöÄ</div>'; 
  hero = document.getElementById("hero");
  hero.style.left = heroPos + "%";

  answers.forEach((num, index) => {
    let asteroid = document.createElement("div");
    asteroid.className = "asteroid";
    asteroid.style.left = (10 + index * 20) + "%";
    asteroid.innerHTML = `
      ‚òÑÔ∏è
      <div class="number">${num}</div>
    `;
    asteroid.dataset.correct = num === correctAnswer;

    gameArea.appendChild(asteroid);

    let pos = -60;

    let fall = setInterval(() => {
      if (gameOver) {
        clearInterval(fall);
        asteroid.remove();
        return;
      }

      pos += 2;
      asteroid.style.top = pos + "px";

      if (pos > 330) {
        clearInterval(fall);

        let heroRect = hero.getBoundingClientRect();
        let asteroidRect = asteroid.getBoundingClientRect();

        if (
          heroRect.left < asteroidRect.right &&
          heroRect.right > asteroidRect.left &&
          asteroid.dataset.correct === "true"
        ) {
          score += 10;
          document.getElementById("score").innerText = score;
        } else if (asteroid.dataset.correct === "true") {
          lives--;
          document.getElementById("lives").innerText = lives;
        }

        asteroid.remove();

        if (lives <= 0) endGame();
      }

    }, 30);
  });
}


  async function endGame() {
    gameOver = true;
    alert("Game Over! Skor: " + score);

    let name = document.getElementById("name").value;
    let kelas = document.getElementById("class").value;

    if (name && kelas) {
      await supabaseClient.from("astro_scores").insert([
        { name: name, class: kelas, score: score, accuracy: 100, sifir: sifir }
      ]);
    }
  }

  setInterval(spawnAsteroids, 4000);
</script>

</body>
</html>

